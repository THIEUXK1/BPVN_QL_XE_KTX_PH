
@{
    ViewData["Title"] = "CTDon";
    Layout = "~/Areas/XE/Views/Shared/_Layout.cshtml";
}
@model BPVN_QL_XE_KTX_PH.Areas.XE.Controllers.XeController.DonViewModel

<body style="margin:0; font-family:Segoe UI, sans-serif;
             background:linear-gradient(135deg,#c3e0ff,#1e3c72);
             display:flex; justify-content:center; align-items:center; min-height:100vh;">

    <!-- Tờ A4 ngang -->
    <div style="width:1000px; max-width:95%; aspect-ratio:1.414;
                background:#fff; border-radius:15px; box-shadow:0 12px 30px rgba(0,0,0,0.35);
                padding:40px; display:flex; flex-direction:column; margin:auto;">

        <!-- Tiêu đề -->
        <h2 style="text-align:center; color:#1e3c72; margin-bottom:30px; font-size:1.8rem;">📄 @Model.TieuDe</h2>

        <!-- Thông tin chi tiết -->
        <div style="display:flex; flex-wrap:wrap; gap:15px; color:#1e3c72; font-size:1rem; justify-content:space-between; margin-bottom:25px;">
            <span><strong>Người tạo:</strong> @Model.TenNguoiTao</span>
            <span><strong>Bộ phận:</strong> @Model.BoPhanDangKy</span>
            <span><strong>Mục Đích:</strong> @Model.MucDich</span>
            <span><strong>Cổng:</strong> @Model.CongVao</span>
            <span><strong>Mã đơn:</strong> @Model.MaDon</span>
            <span><strong>Tạo:</strong> @(Model.NgayTao?.ToString("dd/MM/yyyy HH:mm") ?? "-")</span>
            <span><strong>Vào dự kiến:</strong> @(Model.GioVaoDuKien?.ToString("dd/MM/yyyy HH:mm") ?? "-")</span>
            <span><strong>Vào:</strong> @(Model.ThoiGianVao?.ToString("dd/MM/yyyy HH:mm") ?? "-")</span>
            <span><strong>Ra:</strong> @(Model.ThoiGianRa?.ToString("dd/MM/yyyy HH:mm") ?? "-")</span>
            <span>
                <strong>Trạng thái:</strong>
                <span style="padding:0.4rem 0.8rem; border-radius:5px; font-weight:bold;
                             background-color:@(Model.TrangThai == "Đang chờ xét duyệt" ? "#ffc107" : "#198754");
                             color:@(Model.TrangThai == "Đang chờ xét duyệt" ? "#212529" : "#fff");">
                    @Model.TrangThai
                </span>
            </span>
        </div>

        <!-- Timeline ngày Vào/Ra/Dự kiến -->
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; font-size:0.95rem; color:#1e3c72;">
            <div style="text-align:center;">
                <div style="font-weight:bold;">Vào dự kiến</div>
                <div>@(Model.GioVaoDuKien?.ToString("dd/MM/yyyy HH:mm") ?? "-")</div>
            </div>
            <div style="flex:1; height:2px; background:#1e3c72; margin:0 10px;"></div>
            <div style="text-align:center;">
                <div style="font-weight:bold;">Vào</div>
                <div>@(Model.ThoiGianVao?.ToString("dd/MM/yyyy HH:mm") ?? "-")</div>
            </div>
            <div style="flex:1; height:2px; background:#1e3c72; margin:0 10px;"></div>
            <div style="text-align:center;">
                <div style="font-weight:bold;">Ra</div>
                <div>@(Model.ThoiGianRa?.ToString("dd/MM/yyyy HH:mm") ?? "-")</div>
            </div>
        </div>

        <!-- Ảnh lớn -->
        <div style="flex:1; display:flex; justify-content:center; align-items:center; background:#000; padding:10px; border-radius:12px; overflow:hidden; margin-bottom:20px;">
            @if (Model.Anh != null && Model.Anh.Length > 0)
            {
                var base64 = Convert.ToBase64String(Model.Anh);
                <img id="detailImage" src="data:image/png;base64,@base64"
                     style="width:100%; max-height:100%; border-radius:12px; object-fit:contain; filter:brightness(0.85); cursor:pointer;"
                     title="Click để xem ảnh lớn" />
            }
            else
            {
                <span style="color:#6c757d;">Chưa có ảnh</span>
            }
        </div>

        <!-- Nút quay lại -->
        <div style="text-align:center; margin-top:10px;">
            <a href="/DonXetDuyet/TrangChu"
               style="text-decoration:none; background:linear-gradient(90deg,#1e3c72,#2a5298); color:#fff;
                      padding:12px 25px; border-radius:10px; font-weight:bold; box-shadow:0 5px 15px rgba(0,0,0,0.25); transition:0.3s;">
                ← Quay lại danh sách
            </a>
        </div>
    </div>

    <!-- Lightbox -->
    <div id="lightbox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
                                background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:9999;">
        <img id="lightboxImg" src="" style="max-width:90%; max-height:90%; border-radius:12px; box-shadow:0 0 20px rgba(255,255,255,0.3);" />
    </div>

    <script>
        const img = document.getElementById("detailImage");
        const lightbox = document.getElementById("lightbox");
        const lightboxImg = document.getElementById("lightboxImg");

        img?.addEventListener("click", () => {
            lightbox.style.display = "flex";
            lightboxImg.src = img.src;
        });

        lightbox.addEventListener("click", (e) => {
            if (e.target === lightbox || e.key === "Escape") {
                lightbox.style.display = "none";
            }
        });

        document.addEventListener("keydown", (e) => {
            if(e.key === "Escape"){
                lightbox.style.display = "none";
            }
        });
    </script>
</body>
